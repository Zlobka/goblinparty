---
import Layout from "../../../layouts/Layout.astro";
import List from "../../../layouts/List.astro";
import Pagetitle from "../../../layouts/Pagetitle.astro";
import { creatures } from "../../../data/creatures"; // Импортируем массив существ

// Инициализируем переменные для поиска
let searchQuery = "";
let filteredСreatures = creatures;
---

<Layout title="Существа">
	<div class="search-container">
		<div class="search-header">
			<Pagetitle pagetitle="Существа" />
			<input
				id="searchInput"
				type="text"
				placeholder="Поиск по названию..."
				value={searchQuery}
				class="search-input"
			/>
		</div>
	</div>

	<div class="image-gallery" data-creatures={JSON.stringify(creatures)}>
		<div class="image-row">
			{
				filteredСreatures.length > 0 ? (
					filteredСreatures.map((creature) => (
						<List
							enname={creature.enname}
							link={creature.link}
							img={creature.img}
						/>
					))
				) : (
					<p>Существа не найдены.</p>
				)
			}
		</div>
	</div>
</Layout>

<script type="module">
	const searchInput = document.getElementById("searchInput");
	const imageRow = document.querySelector(".image-row");

	// Получаем данные существ из data-атрибута
	const creatures = JSON.parse(
		imageRow.closest(".image-gallery").getAttribute("data-creatures"),
	);

	// Фильтруем существа по запросу
	searchInput.addEventListener("input", function () {
		const query = searchInput.value.toLowerCase();
		const filtered = creatures.filter((creature) =>
			creature.enname.toLowerCase().includes(query),
		);

		// Очищаем текущие элементы и отображаем отфильтрованные
		imageRow.innerHTML = "";

		if (filtered.length > 0) {
			// Добавляем отфильтрованные существа
			filtered.forEach((creature) => {
				const creatureElement = document.createElement("div");
				creatureElement.classList.add("image-item");
				creatureElement.innerHTML = `
					<a href="${creature.link}">
						<p>${creature.enname}</p>
					</a>
					<a href="${creature.link}">
						<img src="${creature.img}" alt="${creature.enname}" width="250" height="350">
					</a>
				`;
				imageRow.appendChild(creatureElement);
			});
		} else {
			// Если существа не найдены
			imageRow.innerHTML = "<p>Существа не найдены.</p>";
		}
	});
</script>
