---
import Layout from "../../../layouts/Layout.astro";
import List from "../../../layouts/List.astro";
import Pagetitle from "../../../layouts/Pagetitle.astro";
import { tokens } from "../../../data/tokens"; // Импортируем массив токенов

// Инициализируем переменные для поиска
let searchQuery = "";
let filteredTokens = tokens;
---

<Layout title="Токены">
    <div class="search-container">
        <div class="search-header">
            <Pagetitle pagetitle="Токены" />
            <input
                id="searchInput"
                type="text"
                placeholder="Поиск по названию..."
                value={searchQuery}
                class="search-input"
            />
        </div>
    </div>

    <div class="image-gallery" data-tokens={JSON.stringify(tokens)}>
        <div class="image-row">
            {
                filteredTokens.length > 0 ? (
                    filteredTokens.map((token) => (
                        <List
                            enname={token.enname}
                            link={token.link}
                            img={token.img}
                        />
                    ))
                ) : (
                    <p>Токены не найдены.</p>
                )
            }
        </div>
    </div>
</Layout>

<!-- Добавляем скрипт для поиска -->
<script type="module">
    const searchInput = document.getElementById("searchInput");
    const imageRow = document.querySelector(".image-row");

    // Получаем токены из data-атрибута
    const tokens = JSON.parse(
        imageRow.closest(".image-gallery").getAttribute("data-tokens"),
    );

    searchInput.addEventListener("input", function () {
        const query = searchInput.value.toLowerCase();
        const filtered = tokens.filter((token) =>
            token.enname.toLowerCase().includes(query),
        );

        // Очищаем текущие элементы и отображаем отфильтрованные
        imageRow.innerHTML = "";

        if (filtered.length > 0) {
            filtered.forEach((token) => {
                const tokenElement = document.createElement("div");
                tokenElement.classList.add("image-item");
                tokenElement.innerHTML = `
            <a href="${token.link}"><p>${token.enname}</p></a>
            <a href="${token.link}"><img src="${token.img}" alt="${token.enname}" width="250" height="350"></a>
          `;
                imageRow.appendChild(tokenElement);
            });
        } else {
            imageRow.innerHTML = "<p>Токены не найдены.</p>";
        }
    });
</script>
